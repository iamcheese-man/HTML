<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Minesweeper" />
<link rel="apple-touch-icon" href="icon.png" />
  <meta charset="UTF-8" />
  <title>Minesweeper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-light: #f4f4f4;
      --tile-light: #e0e0e0;
      --tile-revealed-light: #ffffff;
      --text-light: #222;
      --mine-light: #ff4d4d;

      --bg-dark: #121212;
      --tile-dark: #1e1e1e;
      --tile-revealed-dark: #2b2b2b;
      --text-dark: #f0f0f0;
      --mine-dark: #ff4d4d;

      --transition: 0.3s all ease;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      user-select: none;
    }

    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    h1 {
      margin-bottom: 10px;
      user-select: text;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      width: 260px;
      margin-bottom: 10px;
    }

    .mine-counter {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .theme-toggle {
      background: none;
      border: 2px solid currentColor;
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(10, 26px);
      grid-template-rows: repeat(10, 26px);
      gap: 4px;
      margin-top: 10px;
    }

    .tile {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
      background-color: var(--tile-light);
      transition: var(--transition);
      user-select: none;
      position: relative;
    }

    body.dark .tile {
      background-color: var(--tile-dark);
    }

    .tile.revealed {
      background-color: var(--tile-revealed-light);
      cursor: default;
    }

    body.dark .tile.revealed {
      background-color: var(--tile-revealed-dark);
    }

    .tile.flag::after {
      content: "üö©";
      position: absolute;
      font-size: 1rem;
      top: 1px;
      left: 5px;
      pointer-events: none;
    }

    .tile.mine.revealed::after {
      content: "üí£";
      position: absolute;
      font-size: 1rem;
      top: 1px;
      left: 6px;
      pointer-events: none;
    }

    /* Numbers show only on revealed tiles */
    .tile.revealed[data-num]:not(.mine)::after {
      content: attr(data-num);
      color: #333;
      position: absolute;
      font-weight: 700;
      pointer-events: none;
      user-select: none;
      top: 1px;
      left: 8px;
    }

    body.dark .tile.revealed[data-num]:not(.mine)::after {
      color: #ddd;
    }

    button#restart {
      margin-top: 15px;
      padding: 6px 12px;
      font-size: 1rem;
      background: #333;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>üí£ Minesweeper</h1>
  <div class="top-bar">
    <div class="mine-counter" id="mineCounter">Mines: 10</div>
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  </div>
  <div class="board" id="board"></div>
  <button id="restart" onclick="init()">üîÅ Restart</button>

  <script>
    const board = document.getElementById('board');
    const mineCounter = document.getElementById('mineCounter');
    const size = 10;
    const mineCount = 10;
    let tiles = [];
    let mines = new Set();
    let flaggedTiles = 0;
    let revealedCount = 0;
    let gameOverState = false;

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function init() {
      board.innerHTML = '';
      tiles = [];
      mines = new Set();
      flaggedTiles = 0;
      revealedCount = 0;
      gameOverState = false;
      mineCounter.textContent = 'Mines: ' + (mineCount - flaggedTiles);

      // Create tiles with no revealed or mine classes and no dataset.num yet
      for (let i = 0; i < size * size; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.dataset.index = i;
        delete tile.dataset.num; // Clean data-num just in case

        tile.addEventListener('click', handleLeftClick);
        tile.addEventListener('contextmenu', handleRightClick);
        board.appendChild(tile);
        tiles.push(tile);
      }

      // Place mines randomly
      while (mines.size < mineCount) {
        const index = Math.floor(Math.random() * tiles.length);
        mines.add(index);
      }

      // Assign numbers to tiles (but don't reveal yet)
      tiles.forEach((tile, i) => {
        if (mines.has(i)) return;
        const neighbors = getNeighbors(i);
        const numMines = neighbors.filter(n => mines.has(n)).length;
        if (numMines > 0) tile.dataset.num = numMines;
      });
    }

    function getNeighbors(index) {
      const x = index % size;
      const y = Math.floor(index / size);
      const neighbors = [];

      for (let dy = -1; dy <= 1; dy++) {
        for (let dx = -1; dx <= 1; dx++) {
          if (dx === 0 && dy === 0) continue;
          const nx = x + dx;
          const ny = y + dy;
          if (nx >= 0 && nx < size && ny >= 0 && ny < size) {
            neighbors.push(ny * size + nx);
          }
        }
      }
      return neighbors;
    }

    function handleLeftClick(e) {
      if (gameOverState) return;
      const tile = e.currentTarget;
      const index = parseInt(tile.dataset.index);
      if (tile.classList.contains('revealed') || tile.classList.contains('flag')) return;

      if (mines.has(index)) {
        reveal(index);
        endGame(false);
        return;
      }

      reveal(index);

      if (revealedCount === size * size - mineCount) {
        endGame(true);
      }
    }

    function handleRightClick(e) {
      e.preventDefault();
      if (gameOverState) return;
      const tile = e.currentTarget;
      if (tile.classList.contains('revealed')) return;

      tile.classList.toggle('flag');
      flaggedTiles += tile.classList.contains('flag') ? 1 : -1;
      mineCounter.textContent = 'Mines: ' + (mineCount - flaggedTiles);
    }

    function reveal(startIndex) {
      const stack = [startIndex];
      const visited = new Set();

      while (stack.length > 0) {
        const index = stack.pop();
        if (visited.has(index)) continue;

        const tile = tiles[index];
        if (!tile || tile.classList.contains('revealed') || tile.classList.contains('flag')) {
          visited.add(index);
          continue;
        }

        tile.classList.add('revealed');
        revealedCount++;
        visited.add(index);

        if (mines.has(index)) {
          tile.classList.add('mine');
          continue; // stop expanding
        }

        if (tile.dataset.num) {
          continue; // stop expanding at numbers
        }

        // Reveal neighbors if empty
        const neighbors = getNeighbors(index);
        neighbors.forEach(n => {
          if (!visited.has(n)) {
            stack.push(n);
          }
        });
      }
    }

    function endGame(won) {
      gameOverState = true;
      tiles.forEach((tile, i) => {
        tile.removeEventListener('click', handleLeftClick);
        tile.removeEventListener('contextmenu', handleRightClick);
        if (mines.has(i)) {
          tile.classList.add('revealed', 'mine');
        }
      });
      mineCounter.textContent = won ? "‚úÖ You won!" : "üí• You hit a mine!";
    }

    init();
  </script>
</body>
</html>
