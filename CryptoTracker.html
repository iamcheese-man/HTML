<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸš€ Crypto Dashboard</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #f5f5f5;
      --fg: #222;
      --card: #fff;
      --accent: #007bff;
      --text-muted: #555;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --fg: #eee;
      --card: #1e1e1e;
      --accent: #4dabf7;
      --text-muted: #aaa;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; padding:1rem;
      font-family:system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
    }
    header {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:1rem;
    }
    header h1 { margin:0; font-size:1.5rem; }
    .theme-toggle {
      cursor:pointer;
      background: none; border:2px solid var(--accent);
      color: var(--accent); padding:0.3rem 0.6rem;
      border-radius:4px; font-size:0.9rem;
    }
    .controls {
      display:flex; flex-wrap:wrap; gap:1rem; margin-bottom:1rem;
    }
    .controls > * {
      background: var(--card);
      padding:0.6rem;
      border-radius:6px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    select, button {
      font-size:1rem;
      padding:0.4rem;
      border:1px solid var(--text-muted);
      border-radius:4px;
      background: var(--card);
      color: var(--fg);
    }
    button { cursor:pointer; }
    #summary { margin-top:1rem; width:100%; border-collapse:collapse; }
    #summary th, #summary td {
      padding:0.6rem; text-align:left;
      border-bottom:1px solid var(--text-muted);
    }
    #summary th { background: var(--card); }
    #chart-container { position:relative; height:400px; }

    @media(max-width:600px) {
      .controls { flex-direction:column; }
    }
  </style>
</head>
<body>

  <header>
    <h1>ðŸš€ Crypto Dashboard</h1>
    <button class="theme-toggle" id="themeToggle">Toggle Dark/Light</button>
  </header>

  <div class="controls">
    <div>
      <label>Coins:</label><br/>
      <select id="coinSelect" multiple size="5">
        <option value="bitcoin" selected>Bitcoin (BTC)</option>
        <option value="ethereum" selected>Ethereum (ETH)</option>
        <option value="litecoin">Litecoin (LTC)</option>
        <option value="ripple">Ripple (XRP)</option>
        <option value="cardano">Cardano (ADA)</option>
      </select>
    </div>
    <div>
      <label>Date Range:</label><br/>
      <select id="daysSelect">
        <option value="1">1â€¯day</option>
        <option value="7" selected>7â€¯days</option>
        <option value="30">30â€¯days</option>
        <option value="90">90â€¯days</option>
        <option value="180">180â€¯days</option>
        <option value="365">365â€¯days</option>
        <option value="max">Max</option>
      </select>
    </div>
    <div>
      <br/>
      <button id="refreshBtn">ðŸ”„ Refresh Now</button>
    </div>
  </div>

  <div id="chart-container">
    <canvas id="priceChart"></canvas>
  </div>

  <table id="summary">
    <thead>
      <tr>
        <th>Coin</th>
        <th>Price (USD)</th>
        <th>24â€¯h Î”%</th>
        <th>Market Cap</th>
      </tr>
    </thead>
    <tbody id="summaryBody">
      <!-- filled dynamically -->
    </tbody>
  </table>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.textContent = savedTheme === 'dark' ? 'Switch to Light' : 'Switch to Dark';

    themeToggle.onclick = () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      themeToggle.textContent = next === 'dark' ? 'Switch to Light' : 'Switch to Dark';
    };

    const coinSelect = document.getElementById('coinSelect');
    const daysSelect = document.getElementById('daysSelect');
    const refreshBtn = document.getElementById('refreshBtn');
    const summaryBody = document.getElementById('summaryBody');
    let priceChart;

    async function fetchSummary(ids) {
      const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids.join(',')}&order=market_cap_desc&per_page=100&page=1&sparkline=false`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Summary fetch failed');
      return await res.json();
    }

    async function fetchChartData(id, days) {
      const url =
        `https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=usd&days=${days}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Chart fetch failed for '+ id);
      return await res.json();
    }

    async function updateAll() {
      const selectedCoins = Array.from(coinSelect.selectedOptions).map(o => o.value);
      const days = daysSelect.value;
      if (!selectedCoins.length) return alert('Select at least one coin');

      refreshBtn.disabled = true;
      summaryBody.innerHTML = `<tr><td colspan="4" style="text-align:center">Loadingâ€¦</td></tr>`;

      try {
        // 1) Summary
        const summary = await fetchSummary(selectedCoins);
        summaryBody.innerHTML = summary.map(c => `
          <tr>
            <td>${c.name} (${c.symbol.toUpperCase()})</td>
            <td>$${c.current_price.toLocaleString()}</td>
            <td style="color:${c.price_change_percentage_24h>=0?'#0a0':'#a00'}">
              ${c.price_change_percentage_24h.toFixed(2)}%
            </td>
            <td>$${c.market_cap.toLocaleString()}</td>
          </tr>
        `).join('');

        // 2) Chart
        const datasets = [];
        for (let coin of selectedCoins) {
          const data = await fetchChartData(coin, days);
          const prices = data.prices.map(p => ({ x: p[0], y: p[1] }));
          datasets.push({
            label: coin.charAt(0).toUpperCase() + coin.slice(1),
            data: prices,
            borderColor: getRandomColor(),
            fill: false,
            tension: 0.1,
          });
        }

        const ctx = document.getElementById('priceChart').getContext('2d');
        if (priceChart) priceChart.destroy();
        priceChart = new Chart(ctx, {
          type: 'line',
          data: { datasets },
          options: {
            parsing: false,
            normalized: true,
            animation: false,
            scales: {
              x: {
                type: 'time',
                time: { tooltipFormat: 'MMM dd HH:mm', unit: days==='1'?'hour':'day' }
              },
              y: { ticks: { callback: v => '$'+v.toLocaleString() } }
            },
            plugins: {
              legend: { position: 'top', labels: { color: 'var(--fg)' } }
            }
          }
        });

      } catch (err) {
        console.error(err);
        summaryBody.innerHTML = `<tr><td colspan="4" style="color:red;text-align:center">Error loading data</td></tr>`;
      } finally {
        refreshBtn.disabled = false;
      }
    }

    function getRandomColor() {
      // pastel random
      const r = Math.floor(150 + Math.random()*80);
      const g = Math.floor(150 + Math.random()*80);
      const b = Math.floor(150 + Math.random()*80);
      return `rgb(${r},${g},${b})`;
    }

    refreshBtn.onclick = updateAll;
    coinSelect.onchange = updateAll;
    daysSelect.onchange = updateAll;

    // autoâ€‘refresh every 60s
    setInterval(updateAll, 60000);

    // initial load
    updateAll();
  </script>
</body>
</html>
