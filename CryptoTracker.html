<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Crypto Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root {
      --bg: #fafafa;
      --fg: #222;
      --card: #fff;
      --accent: #4caf50;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --fg: #eee;
      --card: #1e1e1e;
      --accent: #80e27e;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 1rem;
      background: var(--card);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    main {
      flex: 1;
      padding: 1rem;
      max-width: 1000px;
      margin: 0 auto;
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .controls label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
    }
    .controls input,
    .controls select,
    .controls button {
      margin-top: 0.3rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: var(--card);
      color: var(--fg);
      font-size: 1rem;
    }
    .controls button {
      cursor: pointer;
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .summary {
      display: grid;
      grid-auto-flow: column;
      gap: 1rem;
      overflow-x: auto;
      margin-bottom: 1rem;
    }
    .summary .card {
      background: var(--card);
      padding: 0.8rem;
      border-radius: 6px;
      min-width: 120px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    canvas {
      background: var(--card);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .error {
      color: crimson;
      margin-top: 1rem;
      text-align: center;
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>Crypto Dashboard</h1>
    <button id="theme-toggle">Dark Mode</button>
  </header>
  <main>
    <div class="controls">
      <label>
        Coin:
        <select id="coin-select">
          <option value="bitcoin">Bitcoin</option>
          <option value="ethereum">Ethereum</option>
          <option value="litecoin">Litecoin</option>
          <option value="ripple">Ripple</option>
          <option value="cardano">Cardano</option>
        </select>
      </label>
      <label>
        From:
        <input type="date" id="start-date"/>
      </label>
      <label>
        To:
        <input type="date" id="end-date"/>
      </label>
      <label>
        Autoâ€‘Refresh (s):
        <input type="number" id="refresh-interval" min="0" value="0"/>
      </label>
      <button id="load-btn">Load Data</button>
    </div>

    <div class="summary" id="summary"></div>
    <canvas id="chart" height="200"></canvas>
    <div class="error" id="error-msg"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.onclick = () => {
      const theme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', theme);
      themeToggle.textContent = theme === 'light' ? 'Dark Mode' : 'Light Mode';
    };

    const coinSelect = document.getElementById('coin-select');
    const startInput = document.getElementById('start-date');
    const endInput = document.getElementById('end-date');
    const loadBtn = document.getElementById('load-btn');
    const refreshInput = document.getElementById('refresh-interval');
    const summaryEl = document.getElementById('summary');
    const errorMsg = document.getElementById('error-msg');
    let chart;

    async function fetchHistory(coin, from, to) {
      const url = `https://api.coingecko.com/api/v3/coins/${coin}/market_chart/range`
        + `?vs_currency=usd&from=${Math.floor(from/1000)}&to=${Math.floor(to/1000)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Load failed');
      return res.json();
    }

    async function fetchCurrent(coinList) {
      const ids = coinList.join(',');
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Summary load failed');
      return res.json();
    }

    function renderSummary(data, coin) {
      summaryEl.innerHTML = '';
      for (let id in data) {
        const card = document.createElement('div');
        card.className = 'card';
        const price = data[id].usd.toFixed(2);
        const change = data[id].usd_24h_change.toFixed(2);
        card.innerHTML = `
          <strong>${id.charAt(0).toUpperCase()+id.slice(1)}</strong><br>
          $${price}<br>
          <span style="color:${change>=0?'limegreen':'crimson'}">
            ${change}% (24h)
          </span>
        `;
        summaryEl.appendChild(card);
      }
    }

    function renderChart(prices) {
      const labels = prices.map(p => new Date(p[0]).toLocaleDateString());
      const values = prices.map(p => p[1].toFixed(2));
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('chart'), {
        type: 'line',
        data: {
          labels, datasets: [{
            label: `${coinSelect.value} (USD)`,
            data: values,
            borderColor: 'var(--accent)',
            backgroundColor: 'rgba(0,0,0,0)',
            tension: 0.2
          }]
        },
        options: {
          scales: {
            x: { grid: { display: false } },
            y: { beginAtZero: false }
          }
        }
      });
    }

    let refreshTimer;
    async function loadAll() {
      clearTimeout(refreshTimer);
      errorMsg.textContent = '';
      try {
        const coin = coinSelect.value;
        const from = new Date(startInput.value).getTime();
        const to   = new Date(endInput.value).getTime();
        if (isNaN(from) || isNaN(to) || from >= to) {
          errorMsg.textContent = 'Invalid date range.';
          return;
        }

        const [hist, curr] = await Promise.all([
          fetchHistory(coin, from, to),
          fetchCurrent([coin])
        ]);
        renderSummary(curr);
        renderChart(hist.prices);
      } catch (e) {
        errorMsg.textContent = e.message;
      }

      const interval = parseInt(refreshInput.value, 10);
      if (interval > 0) {
        refreshTimer = setTimeout(loadAll, interval * 1000);
      }
    }

    loadBtn.onclick = loadAll;

    // initialize dates to last 7 days
    const now = new Date(), weekAgo = new Date(now - 7*864e5);
    startInput.value = weekAgo.toISOString().slice(0,10);
    endInput.value   = now.toISOString().slice(0,10);
  </script>
</body>
</html>
